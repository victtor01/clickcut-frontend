<div
  class="fixed -top-10 -right-10 w-[40vh] h-[40vh] bg-indigo-50 dark:bg-indigo-500 rounded-full opacity-50 blur-[10vh] dark:opacity-40"
></div>
<div
  class="fixed -bottom-10 -left-10 w-[40vh] h-[40vh] bg-purple-100 dark:bg-purple-500 rounded-full blur-[10vh] opacity-50 dark:opacity-40"
></div>

<main
  class="flex w-full h-[100vh] overflow-y-auto flex-col bg-violet-50 dark:bg-zinc-900"
  (scroll)="onScroll($event)"
>
 <header
    [ngClass]="{
      'border-gray-200/80 dark:border-zinc-800/80 bg-white/80 dark:bg-zinc-900': scrolled,
      'bg-transparent !border-transparent': !scrolled, 
      'transform -translate-y-full': !headerVisible,
      'transform translate-y-0': headerVisible,
    }"
    class="sticky transition-all top-0 z-40 w-full border-b backdrop-blur-2xl"
  >
    <nav class="container mx-auto flex h-16 items-center justify-between px-4 gap-2 sm:px-6 lg:px-8">
      <a href="#" class="flex flex-1 items-center gap-2" aria-label="Página inicial do ClickCut">
        <i class="material-icons-outlined text-3xl text-indigo-600">bolt</i>
        <span class="text-xl font-bold text-gray-800 dark:text-gray-100">Clickyoup</span>
      </a>

      <div class="hidden md:flex flex-grow items-center justify-center gap-6 bg-black-50">
        <button
          (click)="openCepInput()"
          class="flex items-center gap-2 text-nowrap group p-2 px-4 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="material-icons-outlined text-indigo-600">explore</i>
          <div class="text-left">
            <span class="text-xs text-gray-500 dark:text-gray-400">Sua localização</span>
            <p
              class="font-semibold text-sm text-gray-800 dark:text-gray-200 group-hover:text-indigo-600 dark:group-hover:text-indigo-500"
            >
              {{ userCep || 'Definir CEP' }}
              <i class="material-icons-outlined text-base align-middle">expand_more</i>
            </p>
          </div>
        </button>
        <div class="relative w-full max-w-sm">
          <input
            type="text"
            placeholder="Buscar serviço ou profissional..."
            class="w-full rounded-full border border-gray-300 dark:border-zinc-700 bg-gray-100 dark:bg-zinc-800 py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
          />
          <i class="material-icons-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
            >search</i
          >
        </div>
      </div>

      <div class="flex flex-1 items-center justify-end gap-2 sm:gap-4">
        <button
          aria-label="Buscar"
          class="md:hidden p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"
        >
          <i class="material-icons-outlined">search</i>
        </button>
        <button
          type="button"
          (click)="openLogin()"
          class="hidden sm:block cursor-pointer text-sm font-semibold text-indigo-600 hover:text-indigo-700 dark:text-indigo-500 dark:hover:text-indigo-400 transition-colors"
        >
          Entrar
        </button>
        <button
          [routerLink]="['/hub', 'signup']"
          class="text-sm font-semibold bg-indigo-600 text-white px-4 py-2 rounded-full hover:bg-indigo-700 transition-colors shadow-sm"
        >
          Cadastrar
        </button>
      </div>
    </nav>
  </header>

  @if (showCepModal) {
    <div
      class="fixed inset-0 z-50 flex items-end md:items-center justify-center bg-zinc-950/70 transition-opacity duration-300"
    >
      <div
        class="bg-white dark:bg-zinc-800 rounded-t-xl md:rounded-xl shadow-2xl p-6 w-full max-w-lg transform transition-transform duration-300 translate-y-0"
      >
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Onde você está?</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Precisamos do seu CEP para encontrar os melhores profissionais próximos.
        </p>

        <form (ngSubmit)="saveCepAndCloseModal()">
          <div class="relative mb-4">
            <input
              type="text"
              [formControl]="cepControl"
              placeholder="Digite seu CEP (apenas números)"
              maxlength="8"
              class="w-full rounded-lg border border-gray-300 dark:border-zinc-700 bg-gray-100 dark:bg-zinc-700 py-3 pl-4 pr-12 text-base focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              [ngClass]="{
                'border-red-500 ring-red-500': cepControl.invalid && cepControl.touched,
              }"
            />
            <i
              class="material-icons-outlined absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
              >location_on</i
            >
          </div>

          @if (cepControl.invalid && cepControl.touched) {
            <p class="text-red-500 text-sm mb-4">Por favor, insira um CEP válido com 8 dígitos.</p>
          }

          <div class="flex justify-end gap-3">
            <button
              type="button"
              (click)="showCepModal = false; fetchExplore(null)"
              class="text-sm font-semibold text-gray-600 dark:text-gray-400 px-4 py-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              Continuar sem CEP
            </button>
            <button
              type="submit"
              [disabled]="cepControl.invalid"
              class="text-sm font-semibold bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-700 transition-colors shadow-lg disabled:opacity-50"
            >
              Confirmar Localização
            </button>
          </div>
        </form>
      </div>
    </div>
  }
  <section class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    @if (explore) {
      @if (explore.newBusinesses && explore.newBusinesses.length > 0) {
        <section class="mb-12" aria-labelledby="novos-profissionais-heading">
          <h2
            id="novos-profissionais-heading"
            class="text-2xl sm:text-3xl font-bold flex items-center gap-4 text-gray-900 dark:text-violet-100 mb-6"
          >
            <ng-icon name="saxAwardOutline"></ng-icon>
            Lançamento da plataforma
          </h2>
          <div
            class="flex gap-4 sm:gap-6 overflow-x-auto pb-4 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 [scrollbar-width:none]"
          >
            @for (business of explore.newBusinesses; track business.id) {
              <article class="group w-64 sm:w-72 flex-shrink-0 cursor-pointer">
                <div
                  class="relative overflow-hidden rounded-lg border border-stone-200 dark:border-zinc-700 group-hover:shadow-xl transition-shadow duration-300"
                >
                  @if (business.logoUrl) {
                    <img
                      [src]="business.logoUrl"
                      class="aspect-video w-full object-cover transition-transform duration-300 group-hover:scale-105"
                      [alt]="business.name"
                    />
                  } @else {
                    <div
                      class="aspect-video w-full grid place-items-center relative object-cover transition-transform duration-300 group-hover:scale-105"
                    >
                      <i class="material-icons-outlined !text-3xl">store</i>

                      <div
                        class="absolute -top-10 -right-10 w-48 h-48 bg-indigo-50 dark:bg-indigo-500 rounded-full opacity-60 dark:opacity-40 blur-3xl"
                      ></div>
                      <div
                        class="absolute -bottom-10 -left-10 w-48 h-48 bg-purple-100 dark:bg-purple-500 rounded-full opacity-60 dark:opacity-40 blur-3xl"
                      ></div>
                    </div>
                  }
                  <div
                    class="absolute top-2 left-2 bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg"
                  >
                    NOVO
                  </div>
                </div>
                <div class="pt-3">
                  <h3
                    class="font-semibold text-lg text-gray-800 dark:text-gray-100 truncate group-hover:text-indigo-600 dark:group-hover:text-indigo-500 transition-colors"
                  >
                    {{ business.name }}
                  </h3>
                </div>
              </article>
            }
          </div>
        </section>
      }

      @if (explore.topRatedBusinesses && explore.topRatedBusinesses.length > 0) {
        <section aria-labelledby="destaques-heading">
          <h2
            id="destaques-heading"
            class="text-2xl sm:text-3xl text-gray-600 dark:text-violet-100 font-bold items-center gap-4 flex mb-6"
          >
            <ng-icon name="saxStarOutline"></ng-icon> Em Destaque
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8">
            @for (business of explore.topRatedBusinesses; track business.id) {
              <article
                (click)="openBusinessDetails(business.id)"
                class="group flex items-center gap-4 bg-white overflow-hidden dark:bg-zinc-800 p-3 rounded-lg hover:shadow-lg transition-all duration-300 cursor-pointer border border-zinc-200 dark:border-zinc-700 hover:-translate-y-1"
              >
                @if (business?.logoUrl) {
                  <img
                    [src]="business.logoUrl"
                    class="w-16 h-16 object-cover rounded-full flex-shrink-0"
                    [alt]="business.name"
                  />
                } @else {
                  <div
                    class="aspect-square w-16 grid place-items-center relative object-cover transition-transform duration-300 group-hover:scale-105"
                  >
                    <i class="material-icons-outlined !text-3xl">store</i>

                    <div
                      class="absolute -top-10 -right-10 w-48 h-48 bg-indigo-50 dark:bg-indigo-500 rounded-full opacity-60 dark:opacity-40 blur-3xl"
                    ></div>
                    <div
                      class="absolute -bottom-10 -left-10 w-48 h-48 bg-purple-100 dark:bg-purple-500 rounded-full opacity-60 dark:opacity-40 blur-3xl"
                    ></div>
                  </div>
                }
                <div class="overflow-hidden">
                  <h3 class="font-semibold text-gray-800 dark:text-gray-100 truncate">
                    {{ business.name }}
                  </h3>

                  <p class="text-sm text-gray-500 dark:text-gray-400 truncate">
                    Categoria do Profissional
                  </p>

                  <div class="flex items-center gap-1 text-sm text-yellow-500 mt-1">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 fill-current"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                      />
                    </svg>
                    <p class="text-gray-600 dark:text-gray-400 font-medium">
                      {{ business.averageRating | number: '1.1-1' }}
                    </p>
                  </div>
                </div>
              </article>
            }
          </div>
        </section>
      }
    } @else {
      <div class="space-y-12 animate-pulse">
        <div>
          <div class="h-8 w-1/3 bg-gray-200 dark:bg-zinc-700 rounded-md mb-6"></div>
          <div class="flex gap-4 sm:gap-6">
            @for (_ of [1, 2, 3, 4]; track _) {
              <div class="w-64 sm:w-72 flex-shrink-0">
                <div class="aspect-video w-full bg-gray-300 dark:bg-zinc-700 rounded-lg"></div>
                <div class="h-6 w-4/5 bg-gray-300 dark:bg-zinc-700 rounded-md mt-3"></div>
              </div>
            }
          </div>
        </div>
        <div>
          <div class="h-8 w-1/4 bg-gray-300 dark:bg-zinc-700 rounded-md mb-6"></div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8">
            @for (_ of [1, 2, 3, 4]; track _) {
              <div class="h-24 w-full bg-gray-300 dark:bg-zinc-700 rounded-lg"></div>
            }
          </div>
        </div>
      </div>
    }
  </section>
</main>
