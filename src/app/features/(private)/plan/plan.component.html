<!-- 
  Página de Planos (Refatorada)
  - Modo Light Exclusivo
  - Paleta de cores 'gray' (mais suave)
  - Hierarquia de texto aprimorada
-->
<div class="w-full bg-stone-50 min-h-screen overflow-auto py-20 md:py-28">
  <div class="container mx-auto max-w-7xl px-6 lg:px-8">
    
    <!-- Cabeçalho -->
    <header class="text-center">
      <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
        Escolha o plano perfeito para seu negócio.
      </h1>
      <p class="mt-4 text-lg text-gray-600">
        Comece a gerenciar sua agenda, equipe e finanças hoje mesmo.
      </p>
    </header>

    <!-- Grid de Planos -->
    <div class="mt-16 grid grid-cols-1 gap-8 lg:grid-cols-3">
      
      <!-- Card Plano Solo -->
      <div 
        class="flex flex-col rounded-2xl border bg-white p-8 shadow-sm transition-all duration-300"
        [class.border-indigo-600]="selectedPlan()?.id === 'solo'"
        [class.border-gray-200]="selectedPlan()?.id !== 'solo'"
      >
        <h3 class="text-lg font-semibold text-gray-900">Plano Solo</h3>
        <p class="mt-1 text-sm text-gray-500">Ideal para o profissional autônomo.</p>
        <p class="mt-6">
          <span class="text-4xl font-bold tracking-tight text-gray-900">R$ 37</span>
          <span class="text-sm font-medium text-gray-500">/mês</span>
        </p>

        <button
          (click)="selectPlan('solo')"
          [disabled]="isSubmitting() && selectedPlan()?.id === 'solo'"
          class="mt-6 flex w-full items-center justify-center gap-2 rounded-lg border border-indigo-600 px-4 py-2.5 text-sm font-semibold text-indigo-600 transition-colors hover:bg-indigo-50 disabled:opacity-50"
        >
          <span>Começar com Solo</span>
        </button>

        <!-- Lista de Vantagens -->
        <ul class="mt-8 space-y-4 text-sm text-gray-600">
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">1 Loja</strong> (Business)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">1 Profissional</strong> (o Dono)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">150 Agendamentos</strong>/mês</span>
          </li>
          <li class="flex items-center gap-3 text-gray-400">
            <mat-icon class="!text-sm">close</mat-icon>
            <span>Gestão de Equipe e Cargos</span>
          </li>
          <li class="flex items-center gap-3 text-gray-400">
            <mat-icon class="!text-sm">close</mat-icon>
            <span>Folha de Pagamento (Comissões)</span>
          </li>
          <li class="flex items-center gap-3 text-gray-400">
            <mat-icon class="!text-sm">close</mat-icon>
            <span>Integração Mercado Pago</span>
          </li>
          <li class="flex items-center gap-3 text-gray-400">
            <mat-icon class="!text-sm">close</mat-icon>
            <span>Página "Explorar"</span>
          </li>
        </ul>
      </div>

      <!-- Card Plano Equipe (Popular) -->
      <div 
        class="relative flex flex-col rounded-2xl border-2 bg-white p-8 shadow-lg shadow-indigo-100 transition-all duration-300"
        [class.border-indigo-600]="selectedPlan()?.id === 'equipe' || !selectedPlan()"
        [class.border-gray-200]="selectedPlan()?.id !== 'equipe' && selectedPlan()"
      >
        <div class="absolute -top-3 left-1/2 -translate-x-1/2">
          <span class="rounded-full bg-indigo-600 px-4 py-1 text-xs font-semibold uppercase tracking-wider text-white">
            Mais Popular
          </span>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Plano Equipe</h3>
        <p class="mt-1 text-sm text-gray-500">Para lojas pequenas e médias.</p>
        <p class="mt-6">
          <span class="text-4xl font-bold tracking-tight text-gray-900">R$ 67</span>
          <span class="text-sm font-medium text-gray-500">/mês</span>
        </p>

        <button
          (click)="selectPlan('equipe')"
          [disabled]="isSubmitting() && selectedPlan()?.id === 'equipe'"
          class="mt-6 flex w-full items-center justify-center gap-2 rounded-lg bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-indigo-500 disabled:opacity-50"
        >
          <span>Começar com Equipe</span>
        </button>

        <!-- Lista de Vantagens -->
        <ul class="mt-8 space-y-4 text-sm text-gray-600">
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">2 Lojas</strong> (Business)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">10 Membros</strong> de Equipe</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">500 Agendamentos</strong>/mês</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Gestão de Equipe e Cargos</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Folha de Pagamento (Comissões)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Integração Mercado Pago</span>
          </li>
          <li class="flex items-center gap-3 text-gray-400">
            <mat-icon class="!text-sm">close</mat-icon>
            <span>Página "Explorar"</span>
          </li>
        </ul>
      </div>

      <!-- Card Plano Pro -->
      <div 
        class="flex flex-col rounded-2xl border bg-white p-8 shadow-sm transition-all duration-300"
        [class.border-indigo-600]="selectedPlan()?.id === 'pro'"
        [class.border-gray-200]="selectedPlan()?.id !== 'pro'"
      >
        <h3 class="text-lg font-semibold text-gray-900">Plano Pro</h3>
        <p class="mt-1 text-sm text-gray-500">Para negócios que buscam crescer.</p>
        <p class="mt-6">
          <span class="text-4xl font-bold tracking-tight text-gray-900">R$ 90</span>
          <span class="text-sm font-medium text-gray-500">/mês</span>
        </p>

        <button
          (click)="selectPlan('pro')"
          [disabled]="isSubmitting() && selectedPlan()?.id === 'pro'"
          class="mt-6 flex w-full items-center justify-center gap-2 rounded-lg border border-indigo-600 px-4 py-2.5 text-sm font-semibold text-indigo-600 transition-colors hover:bg-indigo-50 disabled:opacity-50"
        >
          <span>Começar com Pro</span>
        </button>
        
        <!-- Lista de Vantagens -->
        <ul class="mt-8 space-y-4 text-sm text-gray-600">
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">4 Lojas</strong> (Business)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">Membros Ilimitados</strong></span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span><strong class="text-gray-800">Agendamentos Ilimitados</strong></span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Gestão de Equipe e Cargos</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Folha de Pagamento (Comissões)</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Integração Mercado Pago</span>
          </li>
          <li class="flex items-center gap-3">
            <mat-icon class="!text-sm text-green-500">check_circle</mat-icon>
            <span>Página "Explorar"</span>
          </li>
        </ul>
      </div>

    </div>
  </div>
</div>

<!-- 
  MODAL DE PAGAMENTO ÚNICO
  Aparece quando um plano é selecionado
-->
@if (selectedPlan(); as plan) {
  <!-- Overlay -->
  <div 
    (click)="closePaymentModal()"
    class="fixed inset-0 z-50 flex animate-fade-in items-center justify-center bg-stone-900/40 p-4 backdrop-blur-sm"
  >
    <!-- Conteúdo do Modal -->
    <div 
      (click)="$event.stopPropagation()"
      class="relative w-full max-w-md rounded-2xl bg-white p-6 shadow-xl animate-scale-in"
    >
      <!-- Botão de Fechar Aprimorado -->
      <button 
        (click)="closePaymentModal()" 
        [disabled]="isSubmitting()"
        class="absolute -top-3 -right-3 flex h-8 w-8 items-center justify-center rounded-full bg-stone-100 text-gray-500 transition-all hover:bg-stone-200 hover:text-gray-700 disabled:opacity-50"
      >
        <mat-icon class="!text-lg">close</mat-icon>
      </button>

      <!-- Cabeçalho do Modal -->
      <div class="text-center">
        <h3 class="text-lg font-semibold text-gray-900">
          Assinar Plano <span class="capitalize text-indigo-600">{{ plan.id }}</span>
        </h3>
        <p class="mt-2 text-2xl font-bold text-gray-800">
          {{ plan.price | currency:'BRL' }}
          <span class="text-base font-normal text-gray-500">/mês</span>
        </p>
      </div>

      <!-- Formulário de Pagamento -->
      <form (submit)="submitSubscription()" id="form-checkout" class="mt-8 space-y-4">
            
        <!-- ✨ Placeholder adicionado -->
        <input 
          id="form-checkout-cardholderName" 
          name="cardholderName" 
          type="text"
          placeholder="Nome como no cartão"
          class="h-10 w-full rounded-lg border border-gray-300 p-2 bg-white text-gray-800"
        />
        
        <!-- IFRAME do Número do Cartão -->
        <div id="form-checkout-cardNumber" class="h-10 w-full rounded-lg border border-gray-300 p-2"></div>
        
        <div class="flex gap-4">
          <!-- IFRAME do Mês -->
          <div id="form-checkout-cardExpirationMonth" class="h-10 w-1/2 rounded-lg border border-gray-300 p-2"></div>
          <!-- IFRAME do Ano -->
          <div id="form-checkout-cardExpirationYear" class="h-10 w-1/2 rounded-lg border border-gray-300 p-2"></div>
        </div>
        
        <!-- IFRAME do CVV -->
        <div id="form-checkout-securityCode" class="h-10 w-full rounded-lg border border-gray-300 p-2"></div>
        
        <!-- IFRAME da Bandeira -->
        <select id="form-checkout-issuer" name="issuer" class="h-10 w-full rounded-lg border border-gray-300 p-2 bg-white text-gray-800"></select>
        <!-- IFRAME das Parcelas -->
        <select id="form-checkout-installments" name="installments" class="h-10 w-full rounded-lg border border-gray-300 p-2 bg-white text-gray-800"></select>
        
        <div class="flex gap-4">
          <!-- IFRAME do Tipo de Documento -->
          <select id="form-checkout-identificationType" name="identificationType" class="h-10 w-1/3 rounded-lg border border-gray-300 p-2 bg-white text-gray-800"></select>
          <!-- ✨ Placeholder adicionado -->
          <input 
            id="form-checkout-identificationNumber" 
            name="identificationNumber" 
            type="text"
            placeholder="Número do documento"
            class="h-10 w-2/3 rounded-lg border border-gray-300 p-2 bg-white text-gray-800"
          />
        </div>

        <!-- Botão de Pagamento -->
        <button
          type="submit"
          [disabled]="isSubmitting()"
          class="mt-6 flex w-full items-center justify-center gap-2 rounded-lg bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-indigo-500 disabled:opacity-50"
        >
          @if (isSubmitting()) {
            <i class="material-symbols-outlined animate-spin !text-base">progress_activity</i>
            <span>Processando Pagamento...</span>
          } @else {
            <span>Pagar e Ativar Plano</span>
          }
        </button>
      </form>
      
    </div>
  </div>
}