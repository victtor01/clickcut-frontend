<div class="p-8 pb-[10rem] w-auto mx-auto items-start flex flex-col lg:flex-row gap-8">
  <div class="flex flex-col gap-6 w-full max-w-[30rem]">
    <div>
      <h1 class="text-2xl font-bold text-zinc-900 dark:text-white">Divulgar Agenda</h1>
      <p class="text-sm text-zinc-500">
        Gere uma imagem profissional para postar nos seus Stories.
      </p>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-xs font-bold uppercase text-zinc-500">Selecione o serviço</label>
      <div class="flex flex-col gap-2 max-h-60 overflow-y-auto pr-1 custom-scrollbar">
        @for (item of allServices(); track item.id) {
          <div
            (click)="toggleService(item)"
            class="group flex cursor-pointer items-center justify-between rounded-xl border p-3 transition-all duration-200 hover:border-indigo-300 dark:hover:border-indigo-700"
            [ngClass]="{
              'border-violet-500 bg-violet-50/50 dark:bg-violet-950/30 dark:border-violet-500':
                isSelected(item),
              'border-zinc-200 bg-white dark:border-gray-800 dark:bg-gray-950': !isSelected(item),
            }"
          >
            <div class="flex items-center gap-3 overflow-hidden">
              <div
                class="flex h-5 w-5 shrink-0 items-center justify-center rounded border transition-colors duration-200"
                [ngClass]="{
                  'border-violet-500 bg-violet-500 dark:bg-violet-600': isSelected(item),
                  'border-zinc-300 bg-white dark:border-zinc-600 dark:bg-gray-800':
                    !isSelected(item),
                }"
              >
                @if (isSelected(item)) {
                  <i class="material-icons-outlined !text-base">check</i>
                }
              </div>

              <div class="flex flex-col truncate">
                <span class="truncate text-sm font-medium text-zinc-900 dark:text-zinc-100">
                  {{ item.title }}
                </span>
                <span class="text-xs text-zinc-500"> {{ item.durationInMinutes }} min </span>
              </div>
            </div>

            <div class="whitespace-nowrap pl-2 text-sm font-semibold text-zinc-900 dark:text-white">
              {{ item.price | toFormatBrl }}
            </div>
          </div>
        }
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-xs font-bold uppercase text-zinc-500">Selecione o Dia</label>
      <app-calendar-picker
        [month]="currentMonth()"
        [year]="currentYear()"
        [availableDays]="availableDays()"
        [selectedDate]="selectedDate()"
        [isLoading]="isLoading()"
        (monthChanged)="onMonthChanged($event)"
        (dateSelected)="onDateSelected($event)"
      ></app-calendar-picker>
    </div>
    
    <div class="flex flex-col gap-2">
      <label class="text-xs font-bold uppercase text-zinc-500">Botão / Ação</label>
      <div class="grid grid-cols-2 gap-2">
        @for (opt of ctaOptions; track opt.type) {
          <button
            (click)="selectCta(opt)"
            class="flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium transition-all"
            [ngClass]="
              selectedCta().type === opt.type
                ? 'border-indigo-500 bg-indigo-50 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300'
                : 'border-zinc-200 bg-white text-zinc-600 hover:bg-zinc-50 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-300 dark:hover:bg-gray-950 dark:hover:text-white'
            "
          >
            <mat-icon class="!text-lg">{{ opt.icon }}</mat-icon>
            <span>{{ opt.label }}</span>
          </button>
        }
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-xs font-bold uppercase text-zinc-500">Escolha o Estilo</label>
      <div class="grid grid-cols-3 gap-3">
        <button
          (click)="selectTemplate('default')"
          class="group relative flex aspect-[9/16] w-full flex-col overflow-hidden rounded-xl border-2 transition-all hover:scale-105 focus:outline-none"
          [ngClass]="
            selectedTemplate() === 'default'
              ? 'border-indigo-500 ring-2 ring-indigo-500/30 shadow-lg shadow-indigo-500/20'
              : 'border-transparent hover:border-zinc-300 dark:hover:border-zinc-700'
          "
        >
          <!-- Miniatura CSS do Default -->
          <div class="absolute inset-0 bg-zinc-900">
            <div
              class="absolute -top-2 -right-2 w-10 h-10 bg-purple-600/50 blur-lg rounded-full"
            ></div>
            <div
              class="absolute bottom-2 left-2 w-8 h-8 bg-indigo-600/50 blur-lg rounded-full"
            ></div>
            <div
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-2 flex flex-col gap-1"
            >
              <div class="h-2 w-8 bg-white/20 rounded mx-auto mb-1"></div>
              <div class="h-1.5 w-12 bg-white/10 rounded mx-auto"></div>
              <div class="grid grid-cols-2 gap-1 mt-2">
                <div class="h-4 rounded bg-white/10"></div>
                <div class="h-4 rounded bg-white/10"></div>
                <div class="h-4 rounded bg-white/10"></div>
                <div class="h-4 rounded bg-white/10"></div>
              </div>
            </div>
          </div>
          <div class="absolute bottom-0 w-full bg-black/60 p-1 text-center backdrop-blur-sm">
            <span class="text-[10px] font-medium text-white">Neon</span>
          </div>
        </button>
        
        <!-- Template Minimal (Clean) -->
        <button
          (click)="selectTemplate('minimal')"
          class="group relative flex aspect-[9/16] w-full flex-col overflow-hidden rounded-xl border-2 transition-all hover:scale-105 focus:outline-none"
          [ngClass]="
            selectedTemplate() === 'minimal'
              ? 'border-indigo-500 ring-2 ring-indigo-500/30 shadow-lg shadow-indigo-500/20'
              : 'border-zinc-200 hover:border-zinc-300 dark:border-zinc-800 dark:hover:border-zinc-700'
          "
        >
          <!-- Miniatura CSS do Minimal -->
          <div class="absolute inset-0 bg-white">
            <div
              class="absolute inset-0 opacity-[0.1]"
              style="
                background-image: radial-gradient(#000 0.5px, transparent 0.5px);
                background-size: 4px 4px;
              "
            ></div>
            <div class="absolute top-4 left-0 w-full flex flex-col items-center gap-1">
              <div class="h-6 w-6 rounded-full border border-zinc-200 bg-white"></div>
              <div class="h-1.5 w-10 bg-zinc-800 rounded"></div>
            </div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-2">
              <div class="grid grid-cols-2 gap-1">
                <div class="h-4 rounded border border-zinc-100 bg-zinc-50"></div>
                <div class="h-4 rounded border border-zinc-100 bg-zinc-50"></div>
                <div class="h-4 rounded border border-zinc-100 bg-zinc-50"></div>
                <div class="h-4 rounded border border-zinc-100 bg-zinc-50"></div>
              </div>
            </div>
          </div>
          <div
            class="absolute bottom-0 w-full bg-white/80 p-1 text-center backdrop-blur-sm border-t border-zinc-100"
          >
            <span class="text-[10px] font-medium text-zinc-900">Clean</span>
          </div>
        </button>

        <button
          (click)="selectTemplate('sunset')"
          class="group relative flex aspect-[9/16] w-full flex-col overflow-hidden rounded-xl border-2 transition-all hover:scale-105 focus:outline-none"
          [ngClass]="
            selectedTemplate() === 'sunset'
              ? 'border-indigo-500 ring-2 ring-indigo-500/30 shadow-lg shadow-indigo-500/20'
              : 'border-transparent hover:border-zinc-300 dark:hover:border-zinc-700'
          "
        >
          <!-- Miniatura CSS do Sunset -->
          <div
            class="absolute inset-0 bg-gradient-to-br from-orange-400 via-rose-500 to-purple-600"
          >
            <div
              class="absolute top-4 left-4 w-6 h-6 bg-white/20 backdrop-blur-md rounded-lg"
            ></div>
            <div class="absolute top-14 left-4 h-4 w-16 bg-white/20 backdrop-blur-md rounded"></div>
            <div
              class="absolute bottom-4 left-1/2 -translate-x-1/2 w-3/4 h-3 bg-black/20 backdrop-blur-md rounded-full"
            ></div>

            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-2">
              <div class="grid grid-cols-2 gap-1">
                <div class="h-4 rounded-full bg-white text-rose-500"></div>
                <div class="h-4 rounded-full bg-white/30"></div>
                <div class="h-4 rounded-full bg-white/30"></div>
                <div class="h-4 rounded-full bg-white/30"></div>
              </div>
            </div>
          </div>
          <div class="absolute bottom-0 w-full bg-black/40 p-1 text-center backdrop-blur-sm">
            <span class="text-[10px] font-medium text-white">Sunset</span>
          </div>
        </button>
      </div>
    </div>

    <button
      (click)="downloadImage()"
      [disabled]="isLoading() || isGenerating()"
      class="hidden items-center justify-center lg:flex gap-2 w-full rounded-xl bg-indigo-600 py-4 font-bold text-white shadow-lg shadow-indigo-600/20 transition-all hover:bg-indigo-500 active:scale-95 disabled:opacity-50"
    >
      @if (isGenerating()) {
        <i class="material-icons-outlined animate-spin">sync</i>
        <span>Gerando...</span>
      } @else {
        <i class="material-icons-outlined">download</i>
        <span>Baixar Imagem</span>
      }
    </button>

    <div
      class="hidden lg:flex rounded-lg bg-blue-50 p-4 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-300"
    >
      <p class="flex gap-2">
        <i class="material-icons-outlined text-base">info</i>
        Dica: Poste essa imagem no Instagram e adicione o link da sua loja como figurinha!
      </p>
    </div>
  </div>

  <div class="relative lg:sticky top-5 min-w-[340px] pointer-events-none">
    <div
      class="relative mx-auto aspect-[9/18] bg-gray-900 border-gray-900 border-[12px] rounded-[2.5rem] shadow-2xl ring-1 ring-white/10"
    >
      <div
        class="absolute top-2 left-1/2 transform -translate-x-1/2 w-28 h-7 bg-gray-900 rounded-full z-50 pointer-events-none shadow-inner border border-white/5 flex items-center justify-between px-3"
      >
        <div class="w-2 h-2 rounded-full bg-gray-800/80"></div>
        <div class="w-1.5 h-1.5 rounded-full bg-gray-800/50"></div>
      </div>

      <div class="w-[4px] h-10 bg-gray-800 absolute -left-[16px] top-28 rounded-l-md"></div>
      <div class="w-[4px] h-16 bg-gray-800 absolute -right-[16px] top-32 rounded-r-md"></div>

      <div class="flex flex-1 w-full h-full overflow-hidden rounded-[2rem]">
        <div #storyCanvas class="flex flex-1">
          @switch (selectedTemplate()) {
            @case ('default') {
              <default-layout-phone
                class="flex-1 flex"
                [data]="data"
              ></default-layout-phone>
            }

            @case ('minimal') {
              <minimal-layout-phone
                class="flex flex-1"
                [data]="data"
              ></minimal-layout-phone>
            }

            @case ('sunset') {
              <sunset-layout-phone
                class="flex flex-1"
                [data]="data"
              ></sunset-layout-phone>
            }
          }
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-1 flex-col w-full px-5 lg:hidden">
    <button
      (click)="downloadImage()"
      [disabled]="isLoading() || isGenerating()"
      class="flex items-center justify-center w-full lg:hidden gap-2 flex-1 rounded-full bg-violet-600 py-4 font-bold text-white shadow-lg shadow-indigo-600/20 transition-all hover:bg-indigo-500 active:scale-95 disabled:opacity-50"
    >
      @if (isGenerating()) {
        <i class="material-icons-outlined animate-spin">sync</i>
        <span>Gerando...</span>
      } @else {
        <i class="material-icons-outlined">download</i>
        <span>Baixar Imagem</span>
      }
    </button>
  </div>
</div>
