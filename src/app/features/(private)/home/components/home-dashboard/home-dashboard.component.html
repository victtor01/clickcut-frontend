<style>
  /* Em src/styles.scss */

  /* Animação para a coroa (pulsação de brilho mais sutil) */
  @keyframes pulse-light {
    0% {
      opacity: 0.8;
      filter: brightness(1);
      transform: scale(1);
    }
    50% {
      opacity: 1;
      filter: brightness(1.2);
      transform: scale(1.05);
    }
    100% {
      opacity: 0.8;
      filter: brightness(1);
      transform: scale(1);
    }
  }

  .animate-pulse {
    animation: pulse-light 2s ease-in-out;
  }

  /* Animação para o fogo (um flicker mais intenso e com leve movimento) */
  @keyframes fire-flicker {
    0%,
    100% {
      opacity: 0.9;
      transform: scale(1) translateY(0);
    }
    25% {
      opacity: 1;
      transform: scale(1.05) translateY(-1px);
    }
    50% {
      opacity: 0.85;
      transform: scale(0.98) translateY(0.5px);
    }
    75% {
      opacity: 1;
      transform: scale(1.03) translateY(-0.5px);
    }
  }

  .animate-fire-flicker {
    animation: fire-flicker 0.8s ease-in-out;
  }
</style>

<div class="flex px-3 relative items-center w-full">
  <div
    class="flex gap-[1rem] lg:flex-wrap lg:grid lg:grid-cols-2 *:lg:last:odd:col-span-2 *:text-nowrap relative items-center scroll-hidden w-full scroll-smooth m-auto overflow-x-auto"
  >
    <div
      class="flex flex-col justify-between rounded-2xl border h-[10rem] min-w-[20rem] p-6 shadow-none dark:shadow-lg backdrop-blur-lg bg-white/60 dark:bg-gray-900/40 border-stone-200/50 dark:border-white/10"
    >
      <header class="justify-between flex items-center gap-2">
        <span class="relative font-medium text-gray-700 dark:text-gray-300"> Receita do Mês </span>
        <div class="relative grid place-items-center h-7 w-7 rounded-lg overflow-hidden">
          <div
            class="absolute inset-0 bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-lg border border-white/20 dark:border-white/5"
          ></div>
          <i
            class="material-icons-outlined !text-lg text-gray-700 dark:text-gray-300 relative z-[1]"
            >trending_up</i
          >
        </div>
      </header>

      <div class="text-left">
        <p class="text-4xl font-bold text-gray-700 dark:text-gray-100 saira-font">
          {{ revenue?.revenue | toFormatBrl }}
        </p>
      </div>

      @if (revenue) {
        <div
          class="flex items-center gap-1"
          [ngClass]="{
            'text-green-600 dark:text-green-500': isRevenueIncrease,
            'text-red-600 dark:text-red-500': !isRevenueIncrease,
          }"
        >
          <span class="text-sm font-medium">
            @if (isRevenueIncrease) {
              +
            }
            {{ revenuePercentageChange | number: '1.0-1' }}%
          </span>
          <span class="text-xs text-gray-500 dark:text-gray-400">vs. Mês Anterior</span>
        </div>
      }
    </div>

    <div
      class="flex flex-col justify-between rounded-2xl border min-w-[20rem] h-[10rem] p-6 shadow-none dark:shadow-lg backdrop-blur-lg bg-white/60 dark:bg-gray-900/40 border-stone-200/50 dark:border-white/10"
    >
      <header class="justify-between flex items-center gap-2">
        <span class="relative font-medium text-gray-700 dark:text-gray-300"> Visão Geral </span>
        <div class="relative grid place-items-center h-7 w-7 rounded-lg overflow-hidden">
          <div
            class="absolute inset-0 bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-lg border border-white/20 dark:border-white/5"
          ></div>
          <i
            class="material-icons-outlined !text-lg text-gray-700 dark:text-gray-300 relative z-[1]"
            >analytics</i
          >
        </div>
      </header>
      <div class="flex-1 flex justify-around mt-3 items-center px-4 gap-2 relative">
        <div class="flex flex-col items-center gap-1 opacity-60 relative -top-3">
          <div
            class="w-14 h-14 grid place-items-center rounded-full bg-stone-50 dark:bg-gray-800/60 border border-gray-100 dark:border-gray-700"
          >
            <span class="text-xl font-bold text-gray-500 dark:text-gray-400 saira-font">{{
              general?.past
            }}</span>
          </div>
          <span class="text-xs text-gray-400 dark:text-gray-500">Passados</span>
        </div>

        <div class="flex flex-col items-center gap-1 relative top-0">
          <div
            class="w-16 h-16 grid place-items-center rounded-full bg-indigo-50 dark:bg-indigo-900/40 border-2 border-indigo-300 dark:border-indigo-700"
          >
            <span class="text-3xl font-bold text-indigo-700 dark:text-indigo-200 saira-font">{{
              general?.today
            }}</span>
          </div>
          <span class="text-xs font-semibold text-indigo-600 dark:text-indigo-300">Hoje</span>
        </div>

        <div class="flex flex-col items-center gap-1 relative -top-5">
          <div
            class="w-14 h-14 grid place-items-center rounded-full bg-stone-50 dark:bg-gray-800/60 border border-gray-100 dark:border-gray-700"
          >
            <span class="text-xl font-bold text-gray-700 dark:text-gray-300 saira-font">{{
              general?.tomorrow
            }}</span>
          </div>
          <span class="text-xs text-gray-500 dark:text-gray-400">Amanhã</span>
        </div>

        <div class="flex flex-col items-center gap-1 relative -top-2">
          <div
            class="w-14 h-14 grid place-items-center rounded-full bg-stone-50 dark:bg-gray-800/60 border border-gray-100 dark:border-gray-700"
          >
            <span class="text-xl font-bold text-gray-700 dark:text-gray-300 saira-font">{{
              general?.future
            }}</span>
          </div>
          <span class="text-xs text-gray-500 dark:text-gray-400">Futuros</span>
        </div>
      </div>
    </div>

    <div
      class="flex flex-col justify-between rounded-2xl border h-[10rem] min-w-[20rem] p-6 shadow-none dark:shadow-lg border-gray-200/70 backdrop-blur-lg bg-white/60 dark:bg-gray-900/40 dark:border-white/10"
    >
      <header class="justify-between flex items-center gap-2">
        <span class="relative font-medium text-gray-700 dark:text-gray-300">
          Métodos de pagamento
        </span>
        <div class="relative grid place-items-center h-7 w-7 rounded-lg overflow-hidden">
          <div
            class="absolute inset-0 bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-lg border border-white/20 dark:border-white/5"
          ></div>
          <i
            class="material-icons-outlined !text-lg text-gray-700 dark:text-gray-300 relative z-[1]"
            >payments</i
          >
        </div>
      </header>

      <div class="flex-1 flex relative justify-between gap-4">
        <app-doughnut-chart
          class="w-[6rem] h-[6rem]"
          [data]="doughnutChartValues"
          [labels]="doughnutChartLabels"
          [colors]="doughnutChartColors"
        ></app-doughnut-chart>

        <div class="flex flex-col gap-1">
          <div class="flex flex-col gap-1">
            <ng-container *ngFor="let method of payMethodsArray | slice: 2 : 4">
              <div class="flex gap-2 items-center">
                <i class="w-2 h-2 rounded-sm" [ngClass]="method.colorClass"></i>
                <span class="text-sm saira-font"> {{ method.count }} {{ method.name }} </span>
              </div>
            </ng-container>
          </div>

          <div class="flex flex-col gap-1">
            <ng-container *ngFor="let method of payMethodsArray | slice: 0 : 2">
              <div class="flex gap-2 items-center">
                <i class="w-2 h-2 rounded-sm" [ngClass]="method.colorClass"></i>
                <span class="text-sm saira-font"> {{ method.count }} {{ method.name }} </span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div
      class="flex flex-col justify-between rounded-2xl border p-6 h-[10rem] min-w-[18rem] shadow-none dark:shadow-lg border-gray-200/70 backdrop-blur-lg bg-white/60 dark:bg-gray-900/40 dark:border-white/10"
    >
      <header class="justify-between flex items-center gap-2">
        <span class="relative font-medium text-gray-700 dark:text-gray-300">
          Serviços populares
        </span>
        <div class="relative grid place-items-center h-7 w-7 rounded-lg overflow-hidden">
          <div
            class="absolute inset-0 bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-lg border border-white/20 dark:border-white/5"
          ></div>
          <i
            class="material-icons-outlined !text-lg text-gray-700 dark:text-gray-300 relative z-[1]"
            >cards_star</i
          >
        </div>
      </header>

      <div class="flex flex-col mt-1">
        @for (service of popularService; track $index) {
          <div class="flex gap-3 items-center animate-fade-in">
            <div
              class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center relative"
            >
              @if ($index === 0) {
                 <i class="material-symbols-outlined !text-emerald-300">crown</i>
              }

              <!-- 2º LUGAR: Foguinho Roxo -->
              @else if ($index === 1) {
                <i class="material-symbols-outlined !text-violet-500">local_fire_department</i>
              }

              <!-- 3º LUGAR: Estrela Bronze -->
              @else if ($index === 2) {
                <i class="material-symbols-outlined !text-amber-500">star</i>
              } @else {
                <div
                  class="h-6 w-6 grid place-items-center rounded-full bg-stone-100 dark:bg-gray-700 text-xs font-bold text-gray-500 dark:text-gray-400"
                >
                  {{ $index + 1 }}
                </div>
              }
            </div>

            <div class="flex flex-grow items-baseline justify-between gap-4">
              <span
                class="text-sm font-medium text-gray-600 saira-font dark:text-gray-200 truncate"
                [title]="service.service.title"
              >
                {{ service.service.title }}
              </span>
              <span class="text-sm font-semibold text-gray-800 dark:text-gray-100">
                {{ service.count }}x
              </span>
            </div>
          </div>
        }
      </div>
    </div>

    <div
      class="flex flex-col justify-between rounded-2xl border h-[10rem] min-w-[20rem] p-6 shadow-none dark:shadow-lg border-gray-200/70 backdrop-blur-lg bg-white/60 dark:bg-gray-900/40 dark:border-white/10"
    >
      <header class="justify-between flex items-center gap-2">
        <span class="relative font-medium text-gray-700 dark:text-gray-300">
          Agendamentos no mês de agosto
        </span>
        <div class="relative grid place-items-center h-7 w-7 rounded-lg overflow-hidden">
          <div
            class="absolute inset-0 bg-white/20 dark:bg-black/10 backdrop-blur-sm rounded-lg border border-white/20 dark:border-white/5"
          ></div>
          <i
            class="material-icons-outlined !text-lg text-gray-700 dark:text-gray-300 relative z-[1]"
            >timeline</i
          >
        </div>
      </header>

      <div class="flex rounded-b-lg overflow-hidden relative flex-1 mt-4 -mx-6 -mb-6">
        <div class="flex h-full flex-1">
          <line-graph
            [labels]="lineChartLabels"
            class="flex-1"
            [data]="lineChartValues"
          ></line-graph>
        </div>
      </div>

      <div
        class="absolute right-6 bottom-6 backdrop-blur-sm z-50 px-4 p-1 grid place-items-center rounded-full bg-violet-500/10 border border-white/20 dark:border-white/5"
      >
        <span class="text-gray-600 font-semibold dark:text-gray-200 saira-font text-base">
          {{ totalBookingsInMonth }} Agendamentos
        </span>
      </div>
    </div>
  </div>
</div>
