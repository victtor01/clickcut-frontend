<div class="mx-auto px-4">
  <header>
    <h1 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
      Equipe e Permissões
    </h1>
    <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">
      Crie cargos, defina permissões e gerencie os membros do seu negócio.
    </p>
  </header>

  <section class="mt-5">
    <div
      class="overflow-hidden rounded-xl border border-gray-200/80 bg-white dark:border-neutral-800 dark:bg-neutral-950/50"
    >
      <div
        class="flex flex-col gap-4 border-b border-gray-200/80 p-6 dark:border-neutral-800 sm:flex-row sm:items-center sm:justify-between"
      >
        <div>
          <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Cargos</h2>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            Crie e edite os cargos para atribuir permissões à sua equipe.
          </p>
        </div>
        <button
          type="button"
          (click)="openRoleModal()"
          class="flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-indigo-500"
        >
          <i class="material-symbols-outlined !text-base">add</i>
          <span>Criar Cargo</span>
        </button>
      </div>

      @if (roles.length > 0) {
        <ul class="divide-y divide-gray-200/80 dark:divide-neutral-800">
          @for (role of roles; track role.id) {
            <li class="flex items-center justify-between gap-4 p-4 sm:p-6">
              <div>
                <p class="font-semibold text-gray-800 dark:text-white">{{ role.name }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  {{ role.permissions.length }} permissões
                </p>
              </div>
              <button
                type="button"
                (click)="openRoleModal(role.id)"
                class="rounded-full grid place-items-center w-12 h-12 text-gray-500 transition-colors hover:bg-stone-100 hover:text-gray-800 dark:text-gray-400 dark:hover:bg-neutral-900 dark:hover:text-gray-100"
              >
                <i class="material-symbols-outlined">edit</i>
              </button>
            </li>
          }
        </ul>
      } @else {
        <div class="p-6 text-center text-sm text-gray-500 dark:text-gray-400">
          Nenhum cargo criado. Comece criando um cargo para sua equipe.
        </div>
      }
    </div>
  </section>

  <section class="mt-4">
    <div
      class="overflow-hidden rounded-xl border border-gray-200/80 bg-white dark:border-neutral-800 dark:bg-neutral-950/50"
    >
      <div
        class="flex flex-col gap-4 border-b border-gray-200/80 p-6 dark:border-neutral-800 sm:flex-row sm:items-center sm:justify-between"
      >
        <div>
          <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Membros da Equipe</h2>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            Convide e gerencie os membros do seu negócio.
          </p>
        </div>
        <a
          [routerLink]="['/configure', 'invites']"
          class="flex items-center gap-2 rounded-full border border-indigo-600 px-4 py-2 text-sm font-semibold text-indigo-600 transition-colors hover:bg-indigo-50 dark:border-indigo-500 dark:text-indigo-400 dark:hover:bg-indigo-500/10"
        >
          <i class="material-symbols-outlined !text-base">person_add</i>
          <span>Convidar Membro</span>
        </a>
      </div>

      @if (members.length > 0) {
        <ul class="divide-y divide-gray-200/80 dark:divide-neutral-800">
          @for (member of members; track member.user.id) {
            <li
              (click)="openMemberDetails(member)"
              class="flex cursor-pointer flex-col items-start gap-4 p-4 sm:flex-row sm:items-center sm:justify-between sm:p-6 hover:bg-stone-100 dark:hover:bg-neutral-900"
            >
              <div class="flex items-center gap-4">
                <div class="relative h-10 w-10 flex-shrink-0">
                  @if (member.user.photoUrl) {
                    <img
                      [src]="member.user.photoUrl"
                      alt="Avatar de {{ member.user.username }}"
                      class="h-full w-full rounded-full object-cover"
                    />
                  } @else {
                    <div
                      class="flex h-full w-full items-center justify-center rounded-full bg-stone-100 dark:bg-neutral-700"
                    >
                      <i class="material-symbols-outlined text-gray-500">person</i>
                    </div>
                  }
                </div>
                <div>
                  <p class="font-semibold text-gray-800 dark:text-white">
                    {{ member.user.username }}
                  </p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">{{ member.user.email }}</p>
                </div>
              </div>
              <div class="flex items-center gap-4 sm:gap-6">
                <div class="flex flex-wrap gap-2">
                  @for (role of member.roles; track role.id) {
                    <span
                      class="rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800 dark:bg-indigo-500/10 dark:text-indigo-400"
                      >{{ role.name }}</span
                    >
                  }
                  @if (member.roles.length === 0) {
                    <span
                      class="rounded-full bg-stone-100 px-2.5 py-0.5 text-xs font-medium text-gray-600 dark:bg-neutral-700 dark:text-gray-300"
                      >Sem cargo</span
                    >
                  }
                </div>
              </div>
            </li>
          }
        </ul>
      } @else {
        <div class="p-6 text-center text-sm text-gray-500 dark:text-gray-400">
          Nenhum membro na equipe. Comece convidando alguém.
        </div>
      }
    </div>
  </section>
</div>
