<div class="w-full">
  <header class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8">
    <div>
      <h1 class="text-2xl font-bold text-zinc-900 dark:text-white saira-font">Minha Carteira</h1>
      <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">
        Gerencie seus cartões salvos para pagamentos rápidos.
      </p>
    </div>

    <button
      routerLink="/configure/plan/method/create"
      class="flex items-center justify-center gap-2 rounded-full bg-violet-600 px-5 py-2 text-sm font-medium text-white transition-all hover:bg-indigo-500 active:scale-95 shadow-lg shadow-indigo-500/20"
    >
      <i class="!text-lg material-icons-outlined">credit_card</i>
      <span>Adicionar Cartão</span>
    </button>
  </header>

  @if (isLoading()) {
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
      @for (i of [1, 2, 3]; track $index) {
        <div class="h-48 w-full animate-pulse rounded-2xl bg-zinc-200 dark:bg-neutral-900"></div>
      }
    </div>
  } @else {
    @if (paymentMethods().length > 0) {
      <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
        @for (card of paymentMethods(); track card.id) {
          <div
            class="group relative h-52 w-full overflow-hidden rounded-2xl bg-gradient-to-br p-6 text-white shadow-xl transition-all hover:-translate-y-1 hover:shadow-2xl"
            [ngClass]="getBrandStyle(card.brand)"
            [class.ring-2]="card.isDefault"
            [class.ring-offset-2]="card.isDefault"
            [class.ring-indigo-200]="card.isDefault"
            [class.dark:ring-offset-zinc-950]="card.isDefault"
          >
            <div
              class="absolute -right-10 -top-10 h-32 w-32 rounded-full bg-white/10 blur-2xl"
            ></div>
            <div
              class="absolute -bottom-10 -left-10 h-40 w-40 rounded-full bg-black/10 blur-2xl"
            ></div>

            <div class="relative z-10 flex h-full flex-col justify-between">
              <div class="flex items-start justify-between">
                <div
                  class="h-8 w-11 rounded bg-gradient-to-r from-yellow-200 to-yellow-400 shadow-sm border border-yellow-500/30 flex items-center justify-center"
                >
                  <div class="w-6 h-4 border border-yellow-600/20 rounded-[2px]"></div>
                </div>

                <div class="flex flex-col items-end gap-1">
                  <div class="relative flex items-center saira-font italic">
                    {{ card.brand }}
                  </div>

                  <div class="flex items-center gap-1 mt-1">
                    @if (!card.isDefault) {
                      <button
                        (click)="setDefaultCard(card.id)"
                        class="flex items-center gap-1 rounded-full bg-black/20 px-2 py-1 text-[10px] font-bold uppercase text-white/80 backdrop-blur-sm transition-all hover:bg-white hover:text-indigo-600 opacity-0 group-hover:opacity-100"
                        title="Definir como principal"
                      >
                        <span>Usar</span>
                        <mat-icon class="!text-sm">check_circle</mat-icon>
                      </button>
                    } @else {
                      <div
                        class="flex items-center gap-1 rounded-full bg-white/20 px-2 py-1 text-[10px] font-bold uppercase text-white backdrop-blur-sm shadow-sm border border-white/30"
                      >
                        <span>Principal</span>
                        <mat-icon class="!text-sm text-green-300">verified</mat-icon>
                      </div>
                    }

                    @if (!card.isDefault) {
                      <button
                        (click)="deleteCard(card.id)"
                        class="rounded-full p-1.5 text-white/60 hover:bg-white/20 hover:text-white transition-colors opacity-0 group-hover:opacity-100"
                        title="Remover cartão"
                      >
                        <mat-icon class="!text-lg">delete</mat-icon>
                      </button>
                    }
                  </div>
                </div>
              </div>

              <div class="flex items-center gap-3 py-2">
                <span class="text-xl tracking-widest opacity-70">•••• •••• ••••</span>
                <span class="font-mono text-2xl tracking-widest shadow-black drop-shadow-sm">
                  {{ card.lastFourDigits }}
                </span>
              </div>

              <div class="flex items-end justify-between">
                <div class="flex flex-col">
                  <span class="text-[10px] uppercase opacity-70">Titular</span>
                  <span class="font-medium tracking-wide truncate max-w-[140px]">
                    {{ card.holderName | uppercase }}
                  </span>
                </div>

                <div class="flex flex-col items-end">
                  <span class="text-[10px] uppercase opacity-70">Validade</span>
                  <span class="font-mono font-medium">
                    {{ card.expirationMonth | number: '2.0' }}/{{ card.expirationYear % 100 }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        }

        <a
          routerLink="/configure/plan/method/create"
          class="flex h-52 w-full cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border-2 border-dashed border-zinc-300 bg-zinc-50 text-zinc-400 transition-all hover:border-indigo-400 hover:bg-indigo-50 hover:text-indigo-500 dark:border-neutral-700 dark:bg-neutral-950/50 dark:hover:border-indigo-500 dark:hover:bg-neutral-900"
        >
          <div
            class="rounded-full bg-white w-10 h-10 grid place-items-center shadow-sm dark:bg-neutral-900"
          >
            <i class="!text-2xl material-icons-outlined">add</i>
          </div>
          <span class="font-medium">Adicionar novo cartão</span>
        </a>
      </div>
    } @else {
      <div class="flex flex-col items-center justify-center py-20 text-center">
        <div class="mb-4 rounded-full bg-zinc-100 p-6 dark:bg-neutral-900">
          <mat-icon class="!h-12 !w-12 !text-5xl text-zinc-400">credit_card_off</mat-icon>
        </div>
        <h3 class="text-lg font-semibold text-zinc-900 dark:text-white">Nenhum cartão salvo</h3>
        <p class="mt-1 max-w-sm text-sm text-zinc-500 dark:text-zinc-400">
          Adicione um cartão para agilizar seus pagamentos e assinaturas.
        </p>
        <button
          routerLink="/configure/plan/method/create"
          class="mt-6 rounded-full bg-indigo-600 px-6 py-2.5 text-sm font-medium text-white transition-colors hover:bg-indigo-500"
        >
          Adicionar Cartão
        </button>
      </div>
    }
  }
</div>
