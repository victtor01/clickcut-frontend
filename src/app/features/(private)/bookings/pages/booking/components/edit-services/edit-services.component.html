<div
  class="flex flex-col rounded-xl border border-gray-100 bg-stone-50 dark:border-gray-800 dark:bg-gray-900"
>
  <div class="p-7">
    <header class="mb-8 flex items-center gap-2 justify-between">
      <div class="block">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white">
          Editar Serviços
        </h1>
        <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">
          Selecione os serviços que fazem parte deste agendamento.
        </p>
      </div>

      <button
        class="w-10 h-10 grid place-items-center rounded-full bg-white dark:bg-gray-800 dark:hover:bg-gray-700 hover:bg-stone-100"
        (click)="close()"
      >
        <i class="material-icons-outlined">close</i>
      </button>
    </header>

    @if (isLoading()) {
      <div class="text-center py-16 text-gray-500 dark:text-gray-400">
        <i class="material-symbols-outlined animate-spin text-4xl">progress_activity</i>
        <p class="mt-2">Carregando serviços...</p>
      </div>
    } @else {
      <div class="space-y-3 pb-28">
        @for (service of allServices(); track service.id) {
          <div
            (click)="toggleServiceSelection(service)"
            class="flex cursor-pointer items-center gap-4 rounded-xl border p-4 transition-all duration-200"
            [ngClass]="{
              'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200 dark:bg-indigo-500/10 dark:border-indigo-700 dark:ring-indigo-900':
                isSelected(service),
              'border-gray-200 bg-white hover:border-gray-300 dark:border-gray-800 dark:bg-gray-800/50 dark:hover:border-gray-700':
                !isSelected(service),
            }"
          >
            <div
              class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full border-2 transition-colors"
              [ngClass]="{
                'border-indigo-600 bg-indigo-600': isSelected(service),
                'border-gray-300 bg-white dark:border-gray-600 dark:bg-gray-700':
                  !isSelected(service),
              }"
            >
              @if (isSelected(service)) {
                <i class="material-symbols-outlined !text-base text-white">check</i>
              }
            </div>
            <div class="flex-grow">
              <p class="font-semibold text-gray-800 dark:text-white">{{ service.title }}</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                {{ service.price / 100 | currency: 'BRL' }} &middot;
                {{ service.durationInMinutes }} min
              </p>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <footer
    class="z-10 w-full border-t border-gray-200 bg-white/80 p-4 backdrop-blur-sm dark:border-gray-800 dark:bg-gray-900/80"
  >
    <div class="mx-auto flex max-w-[54rem] items-center justify-between gap-4">
      <div>
        <p class="font-semibold text-gray-900 dark:text-white">
          {{ selectedServices().length }}
          {{ selectedServices().length === 1 ? 'serviço' : 'serviços' }}
        </p>
        <p class="text-sm text-gray-600 dark:text-gray-400">
          Total: {{ totalPrice() / 100 | currency: 'BRL' }} &middot; {{ totalDuration() }} min
        </p>
      </div>
      <button
        (click)="saveChanges()"
        [disabled]="selectedServices().length === 0"
        class="rounded-full bg-indigo-500 dark:hover:bg-indigo-400 px-10 py-2.5 text-sm font-semibold text-white transition-colors hover:bg-indigo-600 disabled:cursor-not-allowed disabled:bg-indigo-400 dark:disabled:bg-indigo-800"
      >
        Salvar
      </button>
    </div>
  </footer>
</div>
