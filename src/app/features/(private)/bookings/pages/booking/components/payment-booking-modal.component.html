<style>
  /* Sobrescreve a variável de fundo quando o MODO ESCURO está ativo */
  .dark .checkmark {
    --circle-bg: #27272a; /* Fundo do círculo no MODO ESCURO (zinc-800) */
  }

  .checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 3;
    stroke-miterlimit: 10;
    stroke: var(--success-color);
    fill: var(--circle-bg); /* Usa a variável para o fundo */
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
  }

  .checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
  }

  @keyframes stroke {
    100% {
      stroke-dashoffset: 0;
    }
  }

  @keyframes scale {
    0%,
    100% {
      transform: none;
    }
    50% {
      transform: scale3d(1.1, 1.1, 1);
    }
  }

  @keyframes fill {
    100% {
      box-shadow: inset 0px 0px 0px 60px var(--success-color);
    }
  }

  @keyframes pulse-scale {
    0%,
    100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.05);
      opacity: 0.7;
    }
  }
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .spinner-animation {
    /* Define o ponto de origem da rotação para o centro do relógio (x=12, y=16) */
    transform-origin: 12px 16px;
    /* Aplica a animação 'spin' de 1.5s, de forma linear e infinita */
    animation: spin 1.5s linear infinite;
  }
</style>

<div
  class="relative w-full max-w-sm mx-auto bg-white/5 dark:bg-zinc-900/50 border border-white/10 backdrop-blur-xl shadow-2xl rounded-2xl p-6 sm:p-8 text-center"
>
  <button
    type="button"
    (click)="close()"
    class="absolute top-4 right-4 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-white/10 dark:hover:bg-zinc-800/60 transition-colors"
    aria-label="Fechar modal"
  >
    <i class="material-icons-outlined">close</i>
  </button>

  <div class="flex flex-col items-center gap-4" *ngIf="status === 'COMPLETED' && payment ">
    <h2 class="text-2xl font-semibold saira-font text-gray-900 dark:text-gray-50">Pague com PIX</h2>
    <p class="text-sm text-gray-600 dark:text-zinc-400 max-w-xs">
      Abra o app do seu banco, escaneie o código abaixo ou use o Copia e Cola.
    </p>

    <div class="p-4 bg-white rounded-lg shadow-inner my-4">
      <img [src]="'data:image/png;base64,' + base64" />
    </div>

    <div class="w-full text-left">
      <label
        for="pix-code"
        class="text-xs font-semibold uppercase text-gray-500 dark:text-zinc-500 tracking-wider"
      >
        PIX Copia e Cola
      </label>
      <div class="relative w-full flex mt-2">
        <input
          id="pix-code"
          type="text"
          readonly
          [value]="pixCopyPasteCode"
          class="w-full p-3 pr-12 text-sm pointer-events-none truncate rounded-lg bg-gray-100 dark:bg-zinc-800 border-none text-gray-700 dark:text-zinc-300 focus:ring-2 focus:ring-violet-500"
        />
        <button
          type="button"
          (click)="copyCode()"
          class="absolute right-2 top-1/2 -translate-y-1/2 grid place-items-center w-8 h-8 rounded-full text-gray-500 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all duration-200"
          [ngClass]="{ 'bg-emerald-100 dark:bg-emerald-900 !text-emerald-500': isCopied }"
          aria-label="Copiar texto"
        >
          <i *ngIf="isCopied" class="material-icons-outlined transition-opacity">check</i>
          <i *ngIf="!isCopied" class="material-icons-outlined transition-opacity">content_copy</i>
        </button>
      </div>
      <p *ngIf="isCopied" class="text-xs text-emerald-500 mt-2 text-center">
        Código copiado para a área de transferência!
      </p>
    </div>
  </div>

  <div *ngIf="status === 'PAID'" class="flex flex-col items-center justify-center gap-4 py-8">
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
      <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
      <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
    </svg>

    <h2 class="text-2xl font-semibold saira-font text-emerald-400 mt-4">Pagamento Aprovado!</h2>
    <p class="text-sm text-gray-600 dark:text-zinc-400 max-w-xs">
      Obrigado! Em breve você receberá a confirmação no seu e-mail.
    </p>
  </div>

  <div
    *ngIf="status !== 'PAID' && status !== 'COMPLETED'"
    class="flex flex-col items-center justify-center text-center gap-4 py-8"
  >
    <svg
      class="w-32 h-32 text-indigo-300 dark:text-indigo-400 mb-4"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M8 2v4" />
      <path d="M16 2v4" />
      <rect width="18" height="18" x="3" y="4" rx="2" />
      <path d="M3 10h18" />
      <!-- Círculo central do relógio (estático) -->
      <circle cx="12" cy="16" r="0.75" fill="currentColor" />
      <!-- Ponteiro do relógio que será animado -->
      <path class="spinner-animation" d="M12 16v-3" />
    </svg>

    <h2 class="text-2xl font-semibold saira-font text-gray-900 dark:text-gray-50">Quase lá!</h2>
    <p class="text-sm text-gray-600 dark:text-zinc-400 max-w-xs">
      O QR Code para pagamento será gerado assim que o agendamento for concluído pelo profissional.
    </p>
  </div>
</div>
